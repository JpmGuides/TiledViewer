<!doctype html>

<head>
  <title>Tiled Image viewer</title>
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <style>
    body {margin: 0; overflow: hidden; }
    html,body { width: 100%; height: 100%; }
    canvas {width: 100%; height: 80%;}
  </style>
  <script src="../frontend/utils.js"></script>
  <script src="../frontend/affinetransform.js"></script>
  <script src="../frontend/pinchzoom.js"></script>
  <script src="../frontend/CanvasTilesRenderer.js"></script>
  <script src="../frontend/TileLayer.js"></script>
  <script src="../frontend/POILayer.js"></script>
  <script src="../frontend/ArrowLayer.js"></script>
</head>

<body>
    <canvas id="viewer">
    	Your browser is too old.
    </canvas>
    <div id="location"></div>
    <script>

var geojson = 
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "stroke": "#d34356",
        "stroke-width": 4,
        "fill": "rgba(255, 255, 255, .5)"
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [ 4.895439147949219, 52.376332744462054 ],
            [ 4.900932312011719, 52.37675192059285 ],
            [ 4.901790618896484, 52.37339840013861 ],
            [ 4.895954132080078, 52.37329359852117 ],
            [ 4.898185729980469, 52.375179989586506 ],
            [ 4.895439147949219, 52.376332744462054 ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "NameLocal": "Blauwbrug",
        "NameEN": "Blauwbrug (Blue Bridge)",
        "NameDE": "Blauwbrug (Blaue Br√ºcke)",
        "NameFR": "Blauwbrug (Pont bleu)",
        "CategoryID": 12,
        "SubCategoryID": 62,
        "Category": "Architecture",
        "SubCategory": "19th century",
        icon: "nightlife"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [ 4.900905, 52.366326 ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "NameLocal": "Canal Tour",
        "NameEN": "Canal Tour",
        "NameDE": "Grachtenrundfahrt",
        "NameFR": "Tour des canaux",
        "CategoryID": 11,
        "SubCategoryID": 25,
        "Category": "Viewpoint",
        "SubCategory": "Other"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [ 4.802361, 52.423277 ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "NameLocal": "Centraal Station",
        "NameEN": "Centraal Station",
        "NameDE": "Centraal Station",
        "NameFR": "Centraal Station",
        "CategoryID": 1,
        "SubCategoryID": 75,
        "Category": "Urban",
        "SubCategory": "Railway station",
        icon: "visit"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [ 4.900482, 52.379057 ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "NameLocal": "Concertgebouw",
        "NameEN": "Concertgebouw",
        "NameDE": "Concertgebouw",
        "NameFR": "Concertgebouw",
        "CategoryID": 4,
        "SubCategoryID": 93,
        "Category": "Culture",
        "SubCategory": "Theatre / Concert hall / Opera",
        icon: "restaurant"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [ 4.879153, 52.356263 ]
      }
    }
  ]
};
    	var canvasTilesRenderer = new CanvasTilesRenderer({
            canvas: document.getElementById("viewer"),
    	    url: function(scale, x, y) { return "http://b.tile.opencyclemap.org/cycle/" + scale + "/" + x + "/" + y + ".png"; },
    	    initialLocation: {x:0.5136229387648525,y:0.32859961404591626,scale:0.00014809229409828983},
    	    onLocationChange: function(canvasTilesRenderer) {
    	      var location = canvasTilesRenderer.getLocation();
    	      document.getElementById("location").innerHTML = 
    	        "{x:" + location.x + ",y:" + location.y + ",scale:" + location.scale+"}";
    	    },
            maxScale: 0.0011521587604736983,
            minScale: 0.00001464046235355454,
            minX: 0.5131089350307448,
            maxX: 0.5144314546266167,
            minY: 0.32815094051421756,
            maxY: 0.32898929245510206
    	  });

        // Layers will be drawn in the order they are defined.
        // Here, the POI will cover the arrow.
        var arrowLayer = new ArrowLayer({
          renderer: canvasTilesRenderer,
          color: 'rgba(60,20,30,.5)'
          });

        var poiLayer = new POILayer({
          renderer: canvasTilesRenderer,
          geojson: geojson,
          onFeatureClic: function(feature, pos) {
            if (feature) {
              forEachFeature(geojson, function(f) {
                 f.properties.circled = false;
              });
              feature.properties.circled = true;
              arrowLayer.setPoint(geojsonGetCoordinates(feature));
            } else {
              arrowLayer.setPoint(undefined);
            }

            canvasTilesRenderer.refresh();
          }
        });
        poiLayer.loadIcon("nightlife", "Nightlife.png");
        poiLayer.loadIcon("restaurant", "Restaurant.png");
        poiLayer.loadIcon("visit", "Visit.png");

    </script>
</body>
</html>
